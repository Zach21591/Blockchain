<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Make Transaction</title>
    <style>
        body{font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto;} 
        input, textarea, select {display:block; width: 100%; margin-bottom: 10px; padding: 5px;}
        label {font-weight: bold;}
        .result-box {background: #f0f0f0; padding: 15px; border-radius: 5px; margin-top: 20px; display: none; border: 1px solid #ccc;}
        button {padding: 10px 20px; background: #28a745; color: white; border: none; cursor: pointer; font-size: 16px;}
        button:hover {background: #218838;}
    </style>
</head>
<body>
    <h1>Register New IP Asset</h1>
    <form id="txForm">
        <label>Sender Private Key:</label>
        <input type="text" name="sender_private_key" placeholder="Paste your private key here" required>
        
        <label>Sender Public Key (Address):</label>
        <input type="text" name="sender_address" placeholder="Paste your public key here" required>
        
        <label>Recipient Address:</label>
        <input type="text" name="recipient_address" value="0000-Registry-Admin-Address" required>
        
        <label>Product Type:</label>
        <select name="product_type">
            <option value="Music">ðŸŽµ Music / Audio</option>
            <option value="Art">ðŸŽ¨ Digital Art / NFT</option>
            <option value="Patent">ðŸ“œ Patent / Blueprint</option>
            <option value="Code">ðŸ’» Software Code</option>
            <option value="Literature">ðŸ“– Book / Article</option>
        </select>
        
        <label>Asset Hash (SHA256):</label>
        <input type="text" name="asset_hash" placeholder="e.g. 5e884898da28047151d0e56f8dc62927..." required>
        
        <label>Asset Details (Name/Title):</label>
        <input type="text" name="asset_details" placeholder="e.g. 'Summer Vibes - Original Mix'" required>
        
        <button type="button" onclick="sendTx()">Sign & Register</button>
    </form>

    <div id="resultArea" class="result-box">
        <h3>âœ… Registration Successful!</h3>
        <p><strong>Registered On:</strong> <span id="display_time"></span></p>
        <p><strong>Digital Signature:</strong></p>
        <textarea id="signature" readonly style="height: 80px;"></textarea>
    </div>

    <script>
        async function sendTx() {
            const formData = new FormData(document.getElementById('txForm'));
            
            try {
                const response = await fetch('/generate/transaction', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if(response.ok) {
                    document.getElementById('resultArea').style.display = 'block';
                    document.getElementById('signature').value = data.signature;
                    document.getElementById('display_time').innerText = data.transaction.timestamp;
                    alert("Asset Registered Successfully!");
                } else {
                    alert("Error: " + (data.error || "Unknown Error"));
                }
            } catch (error) {
                alert("Server Connection Failed. Is app.py running?");
            }
        }
    </script>
</body>
</html>
